<!DOCTYPE html><html lang="en-US"><head><link rel="preload" as="script" href="/templates/src/containers/Posts.c27851e1.js"/><link rel="preload" as="script" href="/main.66b8befb.js"/><link rel="preload" as="style" href="/styles.css"/><link rel="stylesheet" href="/styles.css"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no"/></head><body><div id="root"><div data-reactroot=""><header class="jss14 jss20 jss5 jss9 jss12"><div class="jss41 jss44 jss42 jss4"><div class="jss45" style="flex:1"><div class="jss46"><div class="jss48 jss49" style="margin-bottom:0" role="tablist"><div class="jss46 jss47"><a class="jss66 jss54 jss56" tabindex="0" role="tab" aria-selected="false" href="/"><span class="jss62"><span class="jss63"><span class="jss64">Home</span></span></span><span class="jss72"></span></a><a class="jss66 jss54 jss56" tabindex="0" role="tab" aria-selected="false" href="/about"><span class="jss62"><span class="jss63"><span class="jss64">About</span></span></span><span class="jss72"></span></a><a class="jss66 jss54 jss56 jss59 active" aria-current="page" tabindex="0" role="tab" aria-selected="true" href="/blog"><span class="jss62"><span class="jss63"><span class="jss64">Posts</span></span></span><span class="jss69 jss71 jss53"></span><span class="jss72"></span></a></div></div></div></div></div></header><main class="jss1"></main></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"/styles.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"blog/tags/C____","templateID":2,"sharedPropsHashes":{},"localProps":null,"allProps":{"title":"tag - C++","posts":[{"id":"msvc_encoding","title":"Visual Studio의 인코딩","date":"2018-10-08T14:47:00.000Z","categories":["software"],"tags":["C++","Visual Studio","git"],"body":"<h2>TL;DR</h2>\n<p>소스코드는 <strong>UTF-8 without signature</strong> + <a href=\"https://editorconfig.org/\">editorconfig</a> 해결.<br>\nrc파일은 현재 답이 없다. 포기하자.</p>\n<h2>멀티바이트 인코딩이 싫어요. 유니코드를 주세요.</h2>\n<p>Visual Studio는 여전히 유니코드를 기본으로 지원하고 있지 않다.\n윈도우에서만, 하나의 언어로만 개발을 한다면 크게 문제가 되지 않는 일이지만,\n여러 언어나, 크로스 플랫폼을 지원하려고 한다면 충분히 문제가 될 수 있는 부분이다.</p>\n<p>해결하는 가장 단순한 방법은 <strong>UTF-8 with signature</strong>로 소스 코드를 저장하는 방법이다.\n하지만 gcc에서 UTF-8 signature이 있는 소스코드 컴파일을 지원하지 않기 때문에 적당한 방법은 아니다.\n그렇다고 <strong>UTF-8 without signature</strong>로 소스 코드를 저장하면 Visual Studio가 알 수 없는 문자가 있다고 워닝을 내뿜는다.<br>\n(<a href=\"https://editorconfig.org/\">editorconfig</a> 없이 <strong>UTF-8 without signature</strong>로 저장해두고 VS에서 편집을 하면 멀티바이트 인코딩으로 저장해버린다.)</p>\n<p>Visual Studio 2015이후로 <code>source-charset</code> 컴파일러 옵션이 추가되어서 멀티바이트 인코딩으로 인식하지 않고,\nUTF-8 signature 없이도 UTF-8로 저장된 소스코드를 컴파일 할 수 있게 되었다.\n<a href=\"https://msdn.microsoft.com/ko-kr/library/mt708819.aspx\">MSDN source-charset</a> 문서를 참고하여 컴파일 옵션에 <code>/source-charset:utf-8</code>을 설정하는 것만으로 적용이 된다.<br>\n다만, 한 프로젝트 안에서 소스코드를 여러 인코딩으로 저장하여 사용 할 수는 없지만, 어차피 UTF-8로 저장하기 위해 이 작업을 했기 때문에 표현 못 하는 문자는 없을테니 문제는 없다.</p>\n<p>소스코드는 해결이 되었으나 리소스에는 여전히 문제가 남아있다.\nVisualStudio에서 rc파일의 인코딩으로 멀티바이트 인코딩 혹은 <strong>UTF-16LE</strong>만을 허용한다.\n<strong>UTF-16LE</strong>으로 저장을 한 경우에 Visual Studio가 읽어들이는데에는 아무 문제가 없으나,\n파일에 BOM이 없으면 Visual Studio상에서 다시 저장을 하기만 하면 멀티바이트 인코딩으로 저장 해버린다.</p>\n<p><strong>UTF-16LE with BOM</strong>으로 저장하면 모든 문제가 해결될 것 같으나, 이번에는 git에서 문제가 발생한다.\ngit에서는 UTF-16으로 저장된 파일을 바이너리 파일로 취급을 해버리며 diff를 제공 해 주지 않는다.\n글 작성 시점에서의 최신 버전인 <strong>git 2.18</strong>에서 새로 추가된 <code>working-tree-encoding</code> 기능으로 UTF-16파일을 바이너리가 아닌 텍스트 파일로 처리를 할 수 있게 되었으나,\n여전히 Visual Studio와 함께쓰는 문제는 남아있다.\ngit에서 <code>working-tree-encoding</code>옵션으로 <code>UTF-16</code>, <code>UTF-16LE</code>, <code>UTF-16BE</code> 총 3종류의 UTF-16을 지원하나 <code>UTF-16</code>만이 BOM을 기록하는 것을 허용한다. LE/BE를 명시하게 되면 BOM이 있는 파일에 대해서 오류가 발생하며, staging이 불가능해진다.\n<code>UTF-16</code>옵션이 시스템에 맞춰서 LE/BE여부를 맞춰준다고 <a href=\"https://git-scm.com/docs/gitattributes#_code_working_tree_encoding_code\">문서</a>에는 작성되어있으나,\n실험해본 환경(Intel CPU, Windows 10) LE가 아닌 BE로만 파일이 생성되어서 Visual Studio에서 사용을 할 수 없었다.</p>\n<p>이런 문제를 확인하고 고민해보았으나 아직까지는 git filter 기능을 사용하여 직접 인코딩을 변환해주는 방법뿐일 것으로 보인다.<br>\n(rc파일은 왜 BE with BOM을 여는데 실패하게 되어있는지 잘 모르겠다.\n더 알 수 없는 포인트는 BE rc파일은 빌드는 되는데 런타임에서 리소스를 읽을 때 에러가 발생한다.)</p>\n"}]},"siteData":{"title":"Perlmint"}};</script><script defer="" type="text/javascript" src="/templates/src/containers/Posts.c27851e1.js"></script><script defer="" type="text/javascript" src="/main.66b8befb.js"></script></body></html>